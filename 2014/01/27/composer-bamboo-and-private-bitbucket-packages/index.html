<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Composer, Bamboo and private Bitbucket packages - Stan Lemon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="I use Atlassian's Bamboo for continuous integration on a lot of projects.">
  <meta name="keywords" content="coding, Composer, Bamboo CI, Git">
  <meta name="author" content="Stan Lemon">
  <meta name="theme-color" content="#FEAE0F"/>
  <link rel="canonical" href="https://stanlemon.com/2014/01/27/composer-bamboo-and-private-bitbucket-packages/">
  <link rel="alternate" type="application/rss+xml" title="Stan Lemon" href="https://stanlemon.com/feed.xml" />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://stanlemon.com/2014/01/27/composer-bamboo-and-private-bitbucket-packages/">
  <meta property="og:title" content="Composer, Bamboo and private Bitbucket packages">
  <meta property="og:description" content="I use Atlassian's Bamboo for continuous integration on a lot of projects.">
  <meta property="og:image" content="https://stanlemon.com/assets/lemon-with-leaves@2x.png">
  <meta property="og:site_name" content="Stan Lemon">
  <meta property="article:published_time" content="2014-01-28T02:28:00+0000">
  <meta property="article:author" content="Stan Lemon">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://stanlemon.com/2014/01/27/composer-bamboo-and-private-bitbucket-packages/">
  <meta name="twitter:title" content="Composer, Bamboo and private Bitbucket packages">
  <meta name="twitter:description" content="I use Atlassian's Bamboo for continuous integration on a lot of projects.">
  <meta name="twitter:image" content="https://stanlemon.com/assets/lemon-with-leaves@2x.png">

  <link rel="preload" as="font" href="/assets/fonts/oswald.woff" type="font/woff2" crossorigin="anonymous">

  <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">

  <link rel="stylesheet" href="/css/main.css">

  <!-- Structured Data / JSON-LD -->
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Composer, Bamboo and private Bitbucket packages",
    "author": {
      "@type": "Person",
      "name": "Stan Lemon"
    },
    "datePublished": "2014-01-28T02:28:00+0000",
    "description": "I use Atlassian's Bamboo for continuous integration on a lot of projects.",
    "image": "https://stanlemon.com/assets/lemon-with-leaves@2x.png",
    "url": "https://stanlemon.com/2014/01/27/composer-bamboo-and-private-bitbucket-packages/",
    "publisher": {
      "@type": "Person",
      "name": "Stan Lemon"
    }
  }
  </script>
  

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LRTQMGFLV3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-LRTQMGFLV3');
  </script>
</head>
<body>

<div class="container" role="main">
  <div class="content">
    <a href="https://stanlemon.com/">
      <img src="https://stanlemon.com/assets/lemon-with-leaves@2x.png" class="post-img" alt="Stan Lemon's logo - a lemon with leaves" />
    </a>

    
<article>
  <div class="columns is-vbottom">
    <div>
      <h2 class="article-title">
        <a href="">Composer, Bamboo and private Bitbucket packages</a>
      </h2>
    </div>
    <h4 class="article-date">Jan 28, 2014</h4>
  </div>

  <hr>

  <p>I use Atlassian's <a href="http://www.atlassian.com/software/bamboo">Bamboo</a> for continuous integration on a lot of projects. I'm a huge fan, it's a solid product with a lot of flexibility and the OnDemand service coupled with EC2 instances and custom EBS volume make for a really robust cloud based solution to continuous integration. Almost every project I put into Bamboo involves a call to load <a href="https://getcomposer.org">composer</a> and install dependencies. Many of the projects I dabble with belong to other people and so they're locked down with some form of authentication and not normally in <a href="http://packagist.org">Packagist</a>. In the past this has created some challenges with installing my composer dependencies, but this past weekend I think I finally found a tolerable solution to my dilemma.</p>
<p>In addition to being a big fan of Atlassian's Bamboo I also really like Atlassian <a href="http://bitbucket.org">Bitbucket</a>. I became a heavy Bitbucket user back before Atlassian bought the product because I was a heavy Mercurial user and it was the only hosted solution available. When they were bought and added <em>git</em> I kept using them because they offer <strong>free</strong> private repositories, whereas competitor GitHub does not. I've had problems when I develop a private package and then want to use it in an application. My workaround up until this weekend was to create a &quot;deployment&quot; user and give them access to my private repository, finally including it's username/password on my vas url in the repository block of my composer.json. This is all sorts of ugly and I have never been satisfied with it. In addition to not being safe or secure it also chews up one of the sacred five users you can team up with on a private repository.</p>
<p>So this weekend I set out to find a different approach to private Bitbucket packages in composer. One that wasn't so ugly and didn't make me feel so insecure about my setup.</p>
<p>BitBucket (and GitHub for that matter) have this concept of a deployment key. It's a private/public ssh key combination that grants read-only access to your repository without chewing up a user account to do so.  It's specifically geared toward the problem I was trying to solve. In my case Bamboo executes it's tasks as the 'bamboo' user.  The trick is getting the private portion of your deployment key into a place that Bamboo can use it.  Bamboo OnDemand creates EC2 instances when it needs to run a build and then terminates it after its done.  This is great because it keeps costs low and it means you don't have to worry about a machine getting gunked up with stuff between builds. It also means there's no shared state between runs, so sticking a private key on your EC2 instance only helps you for a little while.  But wait a minute... what if I set that up with a task in my job when it runs?</p>
<p>I wound up creating an initial task to setup my private deployment key like this:</p>
<p>[gist]https://gist.github.com/stanlemon/8661196[/gist]</p>
<p>Fortunately Bamboo lets you lock down your user's ability to see these sort of things and the logs don't show anything indicating what's going on, which makes it relatively secure - at least seemingly more so than sticking a plain text password in my composer.json file.</p>
<p>Now if you're familiar with Bamboo at all you know that the initial repository setup does not allow you to clone using ssh. This is limited only to the Java implementation of git that Bamboo uses to poll the repository. The default EC2 images ship with a full first class git, and so that means if you declare your package in the repositories block like &quot;<em>git@bitbucket.org:team/project.git</em>&quot; it'll use the aforementioned key and load just fine.</p>
<p>Life is a lot easier with an on-premise install of Bamboo where your disk persists between builds and you can set that key up permanently, but for those of us living in the cloud this will do the trick. You can use this approach on-premise too though and you can even use it with Jenkins if that's your preferred continuous integration implementation.</p>


  

  <hr>
</article>


<p class="text-center">
  <em><a href="https://eepurl.com/gvEkEL">Do you want to get new posts from my website directly in your inbox? Subscribe today!</a></em>
</p>

  </div>
</div>

<footer>
  <div class="text-center">
    <ul>
      <li>
        <a href="https://github.com/stanlemon" rel="noopener" target="_blank" aria-label="You can find some of my coding projects on GitHub" class="social-github">
          <i class="fa-brands fa-github fa-2x" title="GitHub"></i>
        </a>
      </li>
      <li>
        <a href="https://linkedin.com/in/stanlemon" rel="noopener" target="_blank" aria-label="You can find about me professionally on LinkedIn" class="social-linkedin">
          <i class="fa-brands fa-linkedin fa-2x" title="LinkedIn"></i>
        </a>
      </li>
      <li>
        <a href="https://instagram.com/stanlemon" rel="noopener" target="_blank" aria-label="Follow me on Instagram" class="social-instagram">
          <i class="fa-brands fa-instagram fa-2x" title="Instagram"></i>
        </a>
      </li>
      <li>
        <a href="https://threads.net/@stanlemon" rel="noopener" target="_blank" aria-label="Follow me on Threads" class="social-threads">
          <i class="fa-brands fa-threads fa-2x" title="Threads"></i>
        </a>
      </li>
      <li>
        <a href="https://www.youtube.com/@stanlemon" rel="noopener" target="_blank" aria-label="Watch my videos on YouTube" class="social-youtube">
          <i class="fa-brands fa-youtube fa-2x" title="YouTube"></i>
        </a>
      </li>
      <li>
        <a href="https://stanlemon.com/feed.xml" aria-label="Subscribe via RSS" class="social-rss">
          <i class="fa-solid fa-square-rss fa-2x" title="Subscribe via RSS"></i>
        </a>
      </li>
    </ul>
    <p class="copyright">&copy; 2025 Stan Lemon. All rights reserved.</p>
  </div>
</footer>
